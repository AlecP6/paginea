generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               String       @id @default(uuid())
  email            String       @unique
  username         String       @unique
  password         String
  firstName        String?
  lastName         String?
  bio              String?
  avatar           String?
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  bookReviews      BookReview[]
  comments         Comment[]
  friendsInitiated Friendship[] @relation("FriendshipInitiator")
  friendsReceived  Friendship[] @relation("FriendshipReceiver")
  likes            Like[]
  posts            Post[]

  @@map("users")
}

model Friendship {
  id          String           @id @default(uuid())
  status      FriendshipStatus @default(PENDING)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  initiatorId String
  receiverId  String
  initiator   User             @relation("FriendshipInitiator", fields: [initiatorId], references: [id], onDelete: Cascade)
  receiver    User             @relation("FriendshipReceiver", fields: [receiverId], references: [id], onDelete: Cascade)

  @@unique([initiatorId, receiverId])
  @@map("friendships")
}

model Post {
  id        String    @id @default(uuid())
  content   String
  type      PostType  @default(PUBLIC)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  authorId  String
  comments  Comment[]
  likes     Like[]
  author    User      @relation(fields: [authorId], references: [id], onDelete: Cascade)

  @@map("posts")
}

model BookReview {
  id         String        @id @default(uuid())
  bookTitle  String
  bookAuthor String
  bookIsbn   String?
  bookCover  String?
  rating     Int
  review     String?
  status     ReadingStatus @default(READ)
  startedAt  DateTime?
  finishedAt DateTime?
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  authorId   String
  author     User          @relation(fields: [authorId], references: [id], onDelete: Cascade)
  comments   Comment[]
  likes      Like[]

  @@map("book_reviews")
}

model Comment {
  id           String      @id @default(uuid())
  content      String
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  authorId     String
  postId       String?
  bookReviewId String?
  author       User        @relation(fields: [authorId], references: [id], onDelete: Cascade)
  bookReview   BookReview? @relation(fields: [bookReviewId], references: [id], onDelete: Cascade)
  post         Post?       @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@map("comments")
}

model Like {
  id           String      @id @default(uuid())
  createdAt    DateTime    @default(now())
  userId       String
  postId       String?
  bookReviewId String?
  bookReview   BookReview? @relation(fields: [bookReviewId], references: [id], onDelete: Cascade)
  post         Post?       @relation(fields: [postId], references: [id], onDelete: Cascade)
  user         User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, postId])
  @@unique([userId, bookReviewId])
  @@map("likes")
}

enum FriendshipStatus {
  PENDING
  ACCEPTED
  REJECTED
  BLOCKED
}

enum PostType {
  PUBLIC
  FRIENDS
}

enum ReadingStatus {
  WANT_TO_READ
  READING
  READ
  ABANDONED
}
